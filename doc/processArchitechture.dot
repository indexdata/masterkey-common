digraph callgraph {
     fontname="verdana";
     node [fontname="verdana"];
     label="Process Architechture";
     subgraph cluster_legend {
     	      label="Legend"
	      Data[shape="circle", fontsize="9"];
	      UI;
	      Process[shape="box"];
     }
     CF_Builder[label="CF Builder"];
     masterkey[label="MasterKey"];
     masterkey -> serviceProxy[label="PP2 protocol", fontname="verdana"];
     serviceProxy[label="Service\nProxy", shape=box];
     serviceProxy -> pazpar2[label="PP2 protocol"];
     serviceProxy -> Torus[label="TWSP"];
     Torus[shape=box];
     subgraph {
		rank = same; serviceProxy; Torus; Searchables;
     }
     TargetAdmin[label="MK2\nConsole"];
     TargetAdmin -> Torus[label="TWSP"];
     Torus -> Searchables;
     Searchables[label="Data"];
     Searchables[shape=circle];
     Torus -> Torus2[label="TWSP"];
     Torus2[label="Torus 2", shape=box];
     Torus -> harvester:T4[label="TWSP"];
     Torus -> "IRSpy Toroid"[label="TWSP"];
     "IRSpy Toroid" -> Zebra[label="Z39.50"];
     Zebra[shape="record", label="{GFS |<z2> zebra2}"];
     "IRSpy Toroid"[shape="box"];
     Zebra -> IRSpy_DB;
     IRSpy_DB[label="IRSpy\n database", shape=circle];
     IRSpy -> Zebra[label="Z39.50"];
     pazpar2 -> metaProxy[label="Z39.50\nSRU"];
	 metaProxy[label="Metaproxy\n(optional)", shape="box"];
	 metaProxy -> sruTarget[label="SRU"];
	 metaProxy -> zTarget[label="Z39.50"];
	 metaProxy -> cfz[label="Z39.50"];
	 zTarget[label="Z39.50\n Target", shape="box"];
	 zTarget -> zData1;
	 sruTarget -> zData3;
	 cfz[shape="record", label="{cfz | cfengine}"];
	 cfz -> Anything;
	 zData1[shape="circle", label="data"];
	 zData3[shape="circle", label="data"];
	 zTarget[shape="box"];
	 sruTarget[label="SRU\nTarget", shape="box"];
     pazpar2 -> localIndex1[label="Z39.50"];
     pazpar2[label="Pazpar2", shape="box"];
     localIndex1 -> Anything3;
	 localIndex1[shape="record", label="{GFS |<z2> zebra2}"];
     pazpar2 -> localIndex2[label="SOLR"];
     localIndex2[shape="record", label="{SOLR|Lucene}"];
     localIndex2 -> Anything4;

     harvesterAdmin -> harvester;
     harvesterAdmin[label="Harvester\nAdmin"];
     
     harvester[shape="record", label="Harvester|<T4> Torus"];
     harvester -> localIndex2;
     cfRepo[label="CF\nRepo", shape=circle];
     cfz -> cfRepo;
     CF_Builder -> cfRepo;
     subgraph ui_rank {
	rank=same; masterkey; TargetAdmin; CF_Builder; harvesterAdmin; IRSpy;
     	}
     subgraph {
		rank = same; localIndex1; localIndex2; zTarget; 
     	}
     Anything[label="data", shape=circle];
     Anything3[label="data",shape=circle];
     Anything4[label="data",shape=circle];
     subgraph {
		rank = same; Anything; Anything3; zData1; zData3; Anything4; 
	}

}